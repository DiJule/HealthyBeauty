class LocalAiService
# Local AI system for generating product characteristics, benefits and usage without external APIs

# Simple keyword-to-data mappings for reliability
KEYWORDS_MAPPING = {
  # MAKEUP ---------------------------------------------------------------------

  mascara: {
    keywords: %w[туш mascara lash вій],
    characteristics: [
      "Додає об’єму та довжини", "Не осипається", "Виразний чорний пігмент",
      "Підкручує та розділяє вії", "Легко наноситься"
    ],
    benefits: [
      "Виразний погляд", "Об’ємні та підкручені вії", "Тривала стійкість"
    ],
    usage: "Наносьте від коренів до кінчиків у техніці зигзаг. За бажанням повторіть."
  },

  lipstick: {
    keywords: %w[помада lipstick губ],
    characteristics: [
      "Насичений колір", "Зволожуюча формула", "Приємна текстура"
    ],
    benefits: [
      "М'які та доглянуті губи", "Тривалий колір", "Комфортне нанесення"
    ],
    usage: "Нанесіть на губи, за бажанням використовуйте контурний олівець."
  },

  powder: {
    keywords: %w[пудра powder тон матир матуюча],
    characteristics: [
      "Легке покриття", "Матуючий ефект", "Вирівнює тон"
    ],
    benefits: [
      "Без зайвого блиску", "Свіжий вигляд", "Закріплює макіяж"
    ],
    usage: "Наносити пензлем або спонжем на чисту або підготовлену шкіру."
  },

  palette: {
    keywords: %w[палетка тіні тени nyx shadows],
    characteristics: [
      "Яскраві пігменти", "Різні текстури", "Стійкість протягом дня"
    ],
    benefits: [
      "Підходить для щоденного і вечірнього макіяжу", "Легко розтушовується", "Можна поєднувати кольори"
    ],
    usage: "Наносіть на повіки пензлем, створюючи бажаний образ."
  },

  concealer: {
    keywords: %w[консилер скрыть fit me корректор],
    characteristics: [
      "Легка формула", "Добре маскує недоліки", "Під очі та точкове нанесення"
    ],
    benefits: [
      "Освіжує погляд", "Приховує недосконалості", "Не забиває пори"
    ],
    usage: "Нанесіть точково та розтушуйте губкою або пальцями."
  },

  gloss: {
    keywords: %w[блиск блеск gloss shine],
    characteristics: [
      "Сяючий фініш", "Легка текстура", "Зволожує губи"
    ],
    benefits: [
      "Губи виглядають соковитими", "Комфортне носіння", "Підходить щоденно"
    ],
    usage: "Нанесіть на губи самостійно або поверх помади."
  },

  brushes: {
    keywords: %w[пензлі кисти brushes],
    characteristics: [
      "М’який ворс", "Рівномірне нанесення", "Підходить для всіх текстур"
    ],
    benefits: [
      "Дозволяє нанести макіяж професійно", "Не подразнює шкіру", "Тривалий строк служби"
    ],
    usage: "Очищуйте пензлі регулярно для підтримання гігієни."
  },

  # HAIR CARE ------------------------------------------------------------------

  shampoo: {
    keywords: %w[шампунь shampoo миття head shoulders],
    characteristics: [
      "Ефективно очищає волосся", "Бореться з лупою", "Підходить для щоденного використання"
    ],
    benefits: [
      "Свіжа шкіра голови", "Міцніше волосся", "Менше подразнень"
    ],
    usage: "Нанести на вологе волосся, спінити, змити."
  },

  balm: {
    keywords: %w[бальзам кондиционер balsam conditioner gliss],
    characteristics: [
      "Відновлююча формула", "Живить кінчики", "Пом’якшує волосся"
    ],
    benefits: [
      "Менше ламкості", "Гладке волосся", "Полегшує розчісування"
    ],
    usage: "Нанести на довжину волосся, потримати 2–3 хвилини, змити."
  },

  hair_oil: {
    keywords: %w[олія масло oil fructis],
    characteristics: [
      "Живильний комплекс", "Надає блиску", "Захищає від сухості"
    ],
    benefits: [
      "Менше посічених кінчиків", "Блискуче волосся", "Глибоке відновлення"
    ],
    usage: "Нанесіть кілька крапель на кінчики або довжину волосся."
  },

  hair_spray: {
    keywords: %w[спрей укладка лак taft],
    characteristics: [
      "Сильна фіксація", "Без склеювання", "Тривалий ефект"
    ],
    benefits: [
      "Зачіска тримається весь день", "Не обтяжує волосся", "Захист від вологи"
    ],
    usage: "Розпилювати на волосся з відстані 20–30 см."
  },

  hair_mask: {
    keywords: %w[маска волос маска волосся pantene],
    characteristics: [
      "Глибоке відновлення", "Живлення структури волосся", "Підходить для ослабленого волосся"
    ],
    benefits: [
      "Міцніше волосся", "Менше ламкості", "Гладка текстура"
    ],
    usage: "Наносити 1–2 рази на тиждень на 10–15 хвилин."
  },

  hair_brush: {
    keywords: %w[гребінець расческа гребінь щітка brush comb tangle],
    characteristics: [
      "Не травмує волосся", "Підходить для мокрого волосся", "Антистатичний ефект"
    ],
    benefits: [
      "Менше болю при розчісуванні", "Менше сплутувань", "Гладке волосся"
    ],
    usage: "Розчісуйте повільно, починаючи з кінчиків."
  },

  hair_ties: {
    keywords: %w[резинка invisibobble ties scrunchie],
    characteristics: [
      "Не заламує волосся", "М’який матеріал", "Підходить для щоденного використання"
    ],
    benefits: [
      "Менше травмування волосся", "Зручна фіксація", "Не тисне"
    ],
    usage: "Підходить для створення будь-яких зачісок."
  },

  # SKIN CARE ------------------------------------------------------------------

  cream: {
    keywords: %w[крем nivea soft cream],
    characteristics: [
      "Легка формула", "Підходить для щоденного використання", "Швидко вбирається"
    ],
    benefits: [
      "Зволожена шкіра", "М'якість", "Покращення еластичності"
    ],
    usage: "Нанести невелику кількість на чисту шкіру."
  },

  cleanser: {
    keywords: %w[гель умывания очищення cleanser la roche],
    characteristics: [
      "Делікатне очищення", "Підходить для чутливої шкіри", "Не пересушує"
    ],
    benefits: [
      "Чиста та свіжа шкіра", "Менше подразнень", "Підходить для щоденного застосування"
    ],
    usage: "Нанести на вологу шкіру, помасажувати, змити."
  },

  serum: {
    keywords: %w[сироватка serum revitalift],
    characteristics: [
      "Концентрована формула", "Антивіковий ефект", "Зволожує"
    ],
    benefits: [
      "Молодший вигляд", "Рівний тон", "Еластичність шкіри"
    ],
    usage: "Нанести 2–3 краплі перед кремом."
  },

  skin_mask: {
    keywords: %w[маска лице garnier hydra],
    characteristics: [
      "Інтенсивне зволоження", "Освіжаючий ефект", "Заспокоює шкіру"
    ],
    benefits: [
      "Сяйна шкіра", "Повне зволоження за 15 хвилин", "Зменшення сухості"
    ],
    usage: "Нанести на 15 хвилин, зняти, масажувати залишки."
  },

  tonic: {
    keywords: %w[тонік bioderma tonic],
    characteristics: [
      "Заспокоює", "Підходить для чутливої шкіри", "Підготовлює до догляду"
    ],
    benefits: [
      "Менше почервонінь", "Комфортна шкіра", "Відновлення pH"
    ],
    usage: "Нанести ватним диском після очищення."
  },

  # VITAMINS -------------------------------------------------------------------

  vitamin_c: {
    keywords: %w[вітамін c solgar],
    characteristics: [
      "Антиоксидант", "Підтримка імунітету", "Покращує засвоєння заліза"
    ],
    benefits: [
      "Підвищує захист організму", "Бадьорість", "Покращення самопочуття"
    ],
    usage: "Приймати 1 таблетку на день після їжі."
  },

  omega3: {
    keywords: %w[омега omega doppelherz],
    characteristics: [
      "Підтримка серця", "Жирні кислоти EPA+DHA", "Покращує мозкову діяльність"
    ],
    benefits: [
      "Серцево-судинна підтримка", "Користь для мозку", "Загальне зміцнення здоров’я"
    ],
    usage: "Приймати 1 капсулу під час їжі."
  },

  magnesium: {
    keywords: %w[магній магний b6],
    characteristics: [
      "Підтримка нервової системи", "Зменшує втому", "Регулює м’язові функції"
    ],
    benefits: [
      "Кращий сон", "Менше стресу", "Зниження судом"
    ],
    usage: "Приймати 1–2 таблетки на день."
  },

  multivitamin: {
    keywords: %w[supradyn комплекс вітамінів],
    characteristics: [
      "Повний комплекс мікронутрієнтів", "Енергетична підтримка", "Покращує концентрацію"
    ],
    benefits: [
      "Більше енергії", "Краще самопочуття", "Стабільний імунітет"
    ],
    usage: "1 таблетка на день."
  },

  animal_flex: {
    keywords: %w[animal flex суглоб joint],
    characteristics: [
      "Комплекс для суглобів", "Підтримує зв’язки", "Зменшує запалення"
    ],
    benefits: [
      "Менше болю", "Краще рухливість", "Зміцнення суглобів"
    ],
    usage: "Приймати згідно інструкції виробника."
  },

  # ACCESSORIES ---------------------------------------------------------------

  cosmetic_bag: {
    keywords: %w[косметичка oriflame bag],
    characteristics: [
      "Зручний формат", "Міцний матеріал", "Компактний дизайн"
    ],
    benefits: [
      "Легко переносити косметику", "Підходить у подорожі", "Організоване зберігання"
    ],
    usage: "Використовуйте для зберігання косметики та аксесуарів."
  },

  mirror: {
    keywords: %w[дзеркальце mirror compact],
    characteristics: [
      "Компактний розмір", "Легке", "Підходить для сумочки"
    ],
    benefits: [
      "Зручно перевірити макіяж", "Не займає місця", "Завжди під рукою"
    ],
    usage: "Використовуйте за потреби протягом дня."
  }
}.freeze


  def self.analyze_product(product_name, description = "")
    full_text = "#{product_name} #{description}".downcase
    words = full_text.split(/[\s\-,\.]+/)

    best_match = nil
    best_score = 0

    KEYWORDS_MAPPING.each do |category, data|
      score = data[:keywords].count { |keyword| words.include?(keyword) }

      if score > best_score
        best_score = score
        best_match = data
      end
    end

    if best_match && best_score > 0
      return {
        "characteristics" => best_match[:characteristics].shuffle.first(3),
        "benefits" => best_match[:benefits].shuffle.first(3),
        "usage" => best_match[:usage]
      }
    end

    # Default fallback
    default_characteristics = [ "Якісна формула", "Перевірено дерматологом", "Безпечно для шкіри" ]
    default_benefits = [ "Видимий результат", "Приємна текстура", "Легко використовувати" ]
    default_usage = "Нанесіть невелику кількість на очищену шкіру. Дайте засобу повністю впитатися. Використовуйте регулярно для найкращого результату."

    {
      "characteristics" => default_characteristics,
      "benefits" => default_benefits,
      "usage" => default_usage
    }
  end
end
