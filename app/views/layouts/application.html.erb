<!DOCTYPE html>
<html>
  <head>
    <title>Healthy&Beauty</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= favicon_link_tag 'favicon.png' %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/pure-min.css" integrity="sha384-..." crossorigin="anonymous">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <header class="pure-menu pure-menu-horizontal" style="background:#f5f5f5; padding:1em; display:flex; align-items:center; position:relative;">
      <a href="/" class="pure-menu-heading" style="margin-right:2em;">Healthy&Beauty</a>

      <button class="burger-menu" id="burger-menu" aria-label="Меню">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <ul class="pure-menu-list" id="main-menu" style="display:flex; align-items:center; flex:1 1 auto; gap:0.5em; margin:0;">
        <li class="pure-menu-item"><%= link_to 'Головна', root_path, class: 'pure-menu-link' %></li>
        <li class="pure-menu-item"><%= link_to 'Каталог', products_path, class: 'pure-menu-link' %></li>
        <li class="pure-menu-item"><%= link_to 'Помічник', chat_index_path, class: 'pure-menu-link' %></li>
        <li class="pure-menu-item"><%= link_to 'Про нас', about_path, class: 'pure-menu-link' %></li>
        <li class="pure-menu-item"><%= link_to 'Контакти', contact_path, class: 'pure-menu-link' %></li>
      </ul>

      <ul class="pure-menu-list" id="user-menu" style="display:flex; align-items:center; gap:0.5em; margin:0;">
        <% if user_signed_in? %>
          <li class="pure-menu-item">
            <%= link_to (current_user.name.presence || current_user.email), edit_user_registration_path, class: 'pure-menu-link' %>
          </li>

          <% if current_user&.admin? %>
            <li class="pure-menu-item">
              <%= link_to "Адмін-панель", admin_dashboard_path, class: "pure-menu-link" %>
            </li>
          <% end %>
          <li class="pure-menu-item">
            <%= link_to 'Кошик', cart_path, class: 'pure-menu-link' %>
          </li>
          <li class="pure-menu-item">
            <%= link_to 'Замовлення', orders_path, class: 'pure-menu-link', id: 'orders-link' %>
          </li>
          <li class="pure-menu-item"><a href="#" class="pure-menu-link" id="logout-link">Вийти</a></li>
        <% else %>
          <li class="pure-menu-item"><%= link_to 'Вхід', new_user_session_path, class: 'pure-menu-link' %></li>
          <li class="pure-menu-item"><%= link_to 'Реєстрація', new_user_registration_path, class: 'pure-menu-link' %></li>
        <% end %>
      </ul>
    </header>

    <main style="min-height:70vh;">
      <%= yield %>
    </main>

    <footer style="background:#222; color:#fff; text-align:center; padding:1em;">
      &copy; <%= Time.current.year %> Healthy&Beauty. Всі права захищено.
    </footer>
    
    <script>
      document.getElementById('logout-link')?.addEventListener('click', function(event) {
        event.preventDefault();
        fetch('<%= destroy_user_session_path %>', {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': '<%= form_authenticity_token %>',
            'Content-Type': 'application/json'
          },
          credentials: 'same-origin'
        }).then(() => {
          window.location.href = '<%= root_path %>';
        });
      });

      const burger = document.getElementById('burger-menu');
      const mainMenu = document.getElementById('main-menu');
      const userMenu = document.getElementById('user-menu');
      function closeMenus() {
        mainMenu.classList.remove('open');
        userMenu.classList.remove('open');
      }
      function openMenus() {
        mainMenu.classList.add('open');
        userMenu.classList.add('open');
      }
      burger?.addEventListener('click', function(e) {
        e.stopPropagation();
        if (mainMenu.classList.contains('open')) {
          closeMenus();
        } else {
          openMenus();
        }
      });
      document.addEventListener('click', function(e) {
        if (!burger.contains(e.target) && !mainMenu.contains(e.target) && !userMenu.contains(e.target)) {
          closeMenus();
        }
      });
    </script>
  </body>
</html>
